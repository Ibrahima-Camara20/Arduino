<!DOCTYPE HTML>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <link rel="stylesheet"
        href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
        crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="esp.css">

  <title>ESP32</title>
</head>
<body>
  <h1>ESP32</h1>

  <h3>Object status :</h3>
  Uptime : %UPTIME% s<br/>
  Where : %WHERE% <br/>

  <h3>Network link status :</h3>
  WiFi SSID : %SSID%<br/>
  MAC address : %MAC%<br/>
  IP address : %IP%<br/>

  <h3>Sensors status :</h3>
  Temperature : %TEMPERATURE% &deg;C<br/>
  Light : %LIGHT% Lumen<br/>
  Cooler : %COOLER%<br/>
  Heater : %HEATER%<br/>

  <h3>Sensors status WITH GLYPHS :</h3>
  <div class="grid-container">
    <div class="grid-item">
      <i class="fas fa-thermometer-half"></i>
    </div>
    <div class="grid-item">
      <span class="sensors-labels">Temperature</span>
      <span id="temperature">%TEMPERATURE%</span>
      <sup class="units">&deg;C</sup>
    </div>
    <div class="grid-item">
      <i class="far fa-lightbulb"></i>
    </div>
    <div class="grid-item">
      <span class="sensors-labels">Light</span>
      <span id="light">%LIGHT%</span>
      <sup class="units">Lumen</sup>
    </div>
  </div>

  <h3>Temp. Regul. Thresholds :</h3>
  Low Temp : %LT% &deg;C<br/>
  High Temp : %HT% &deg;C<br/>

  <h3>Periodic status report to :</h3>
  <form action="/target" method="post">
    <label for="ip">IP Address :</label>
    <input type="text" name="ip" placeholder="%PRT_IP%"/><br/>
    <label for="port">Port :</label>
    <input type="text" name="port" placeholder="%PRT_PORT%"/><br/>
    <label for="sp">Sampling Period (in seconds) :</label>
    <input type="text" name="sp" placeholder="%PRT_T%"/><br/>
    <input type="submit" value="Change reporting host !"/>
  </form>

  <script>
    // Mise à jour périodique de temperature et light avec Fetch API
    function startUpdate(sensor) {
      setInterval(function () {
        fetch("/" + sensor)
          .then(function (response) {
            if (!response.ok) {
              throw new Error("HTTP error: " + response.status);
            }
            return response.text();
          })
          .then(function (text) {
            document.getElementById(sensor).innerHTML = text;
          })
          .catch(function (error) {
            console.log(error);
          });
      }, 2000);
    }

    document.addEventListener("DOMContentLoaded", function() {
      startUpdate("temperature");
      startUpdate("light");
    });
  </script>
</body>
</html>
